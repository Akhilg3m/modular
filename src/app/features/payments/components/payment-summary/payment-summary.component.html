<div class="payment-summary-container">
  <button class="back-button" (click)="goBack()" *ngIf="!paymentSuccess">‚Üê Back to Payment Options</button>

  <div class="loading-container" *ngIf="isLoading">
    <div class="spinner"></div>
    <p>Loading...</p>
  </div>

  <div class="error-container" *ngIf="errorMessage && !isLoading">
    <div class="error-icon">‚ö†Ô∏è</div>
    <p class="error-message">{{ errorMessage }}</p>
    <button class="primary-button" (click)="goBack()">Go Back</button>
  </div>

  <!-- Payment Success -->
  <div class="success-container" *ngIf="paymentSuccess">
    <div class="success-icon">‚úì</div>
    <h2>Payment Successful!</h2>
    <p>Thank you for your purchase</p>
    <div class="order-details" *ngIf="vehicle">
      <p><strong>Vehicle:</strong> {{ vehicle.Vehicle }}</p>
      <p><strong>Amount Paid:</strong> ${{ vehicle.cost }}</p>
      <p><strong>Payment Method:</strong> {{ paymentMethod | uppercase }}</p>
      <p *ngIf="paymentMethod === 'card'"><strong>Card:</strong> {{ maskedCardNumber }}</p>
      <p><strong>Transaction ID:</strong> {{ transactionId }}</p>
    </div>
    <button class="primary-button" (click)="goToHome()">Continue Shopping</button>
  </div>

  <!-- Payment Form -->
  <div class="payment-form-container" *ngIf="vehicle && !isLoading && !paymentSuccess">
    <div class="payment-header">
      <div class="method-icon">{{ paymentMethod === 'upi' ? 'üì±' : 'üí≥' }}</div>
      <h2>{{ paymentMethod === 'upi' ? 'UPI Payment' : 'Card Payment' }}</h2>
    </div>

    <div class="order-summary">
      <div class="vehicle-info">
        <img [src]="vehicle.image" [alt]="vehicle.Vehicle" class="vehicle-thumb">
        <div class="vehicle-details">
          <h3>{{ vehicle.Vehicle }}</h3>
          <p>{{ vehicle.manufacturer }} {{ vehicle.model }}</p>
        </div>
      </div>
      <div class="amount-row">
        <span>Total Amount</span>
        <span class="amount">${{ vehicle.cost }}</span>
      </div>
    </div>

    <form [formGroup]="paymentForm" (ngSubmit)="onSubmit()">
      <!-- UPI Form -->
      <ng-container *ngIf="paymentMethod === 'upi'">
        <div class="form-group">
          <label for="upiId">UPI ID</label>
          <input type="text" id="upiId" formControlName="upiId" placeholder="yourname@upi"
                 [class.error]="formControls['upiId']?.invalid && formControls['upiId']?.touched">
          <div class="error-text" *ngIf="formControls['upiId']?.invalid && formControls['upiId']?.touched">
            <span *ngIf="formControls['upiId']?.errors?.['required']">UPI ID is required</span>
            <span *ngIf="formControls['upiId']?.errors?.['pattern']">Enter a valid UPI ID (e.g., name&#64;upi)</span>
          </div>
          <p class="helper-text">Examples: name&#64;okaxis, mobile&#64;ybl, username&#64;paytm</p>
        </div>
      </ng-container>

      <!-- Card Form -->
      <ng-container *ngIf="paymentMethod === 'card'">
        <div class="form-group">
          <label for="cardNumber">Card Number</label>
          <input type="text" id="cardNumber" formControlName="cardNumber" placeholder="1234 5678 9012 3456"
                 maxlength="16" (input)="formatCardNumber($event)"
                 [class.error]="formControls['cardNumber']?.invalid && formControls['cardNumber']?.touched">
          <div class="error-text" *ngIf="formControls['cardNumber']?.invalid && formControls['cardNumber']?.touched">
            <span *ngIf="formControls['cardNumber']?.errors?.['required']">Card number is required</span>
            <span *ngIf="formControls['cardNumber']?.errors?.['pattern']">Enter a valid 16-digit card number</span>
          </div>
        </div>

        <div class="form-group">
          <label for="cardholderName">Cardholder Name</label>
          <input type="text" id="cardholderName" formControlName="cardholderName" placeholder="JOHN DOE"
                 [class.error]="formControls['cardholderName']?.invalid && formControls['cardholderName']?.touched">
          <div class="error-text" *ngIf="formControls['cardholderName']?.invalid && formControls['cardholderName']?.touched">
            <span *ngIf="formControls['cardholderName']?.errors?.['required']">Cardholder name is required</span>
            <span *ngIf="formControls['cardholderName']?.errors?.['minlength']">Name must be at least 3 characters</span>
          </div>
        </div>

        <div class="form-row">
          <div class="form-group half">
            <label for="expiryDate">Expiry Date</label>
            <input type="text" id="expiryDate" formControlName="expiryDate" placeholder="MM/YY"
                   maxlength="5" (input)="formatExpiryDate($event)"
                   [class.error]="formControls['expiryDate']?.invalid && formControls['expiryDate']?.touched">
            <div class="error-text" *ngIf="formControls['expiryDate']?.invalid && formControls['expiryDate']?.touched">
              <span *ngIf="formControls['expiryDate']?.errors?.['required']">Required</span>
              <span *ngIf="formControls['expiryDate']?.errors?.['pattern']">Invalid format</span>
            </div>
          </div>

          <div class="form-group half">
            <label for="cvv">CVV</label>
            <input type="password" id="cvv" formControlName="cvv" placeholder="123" maxlength="4"
                   [class.error]="formControls['cvv']?.invalid && formControls['cvv']?.touched">
            <div class="error-text" *ngIf="formControls['cvv']?.invalid && formControls['cvv']?.touched">
              <span *ngIf="formControls['cvv']?.errors?.['required']">Required</span>
              <span *ngIf="formControls['cvv']?.errors?.['pattern']">Invalid CVV</span>
            </div>
          </div>
        </div>

        <div class="card-brands">
          <span>We accept:</span>
          <span class="brand">VISA</span>
          <span class="brand">Mastercard</span>
          <span class="brand">Amex</span>
        </div>
      </ng-container>

      <button type="submit" class="submit-button" [disabled]="isProcessing">
        <span *ngIf="!isProcessing">Pay ${{ vehicle.cost }}</span>
        <span *ngIf="isProcessing">
          <span class="button-spinner"></span>
          Processing...
        </span>
      </button>
    </form>

    <div class="secure-badge">
      <span>üîí</span> Your payment is secure and encrypted
    </div>
  </div>
</div>
